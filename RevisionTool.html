<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Review Pro</title>
    <style>
        :root {
            --bg: #f0f2f5; --primary: #2c3e50; --accent: #3498db;
            --danger: #e74c3c; --success: #27ae60; --text: #333;
        }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); max-width: 900px; margin: 0 auto; padding: 20px; }
        
        .controls, .backup-zone { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .backup-zone { display: flex; align-items: center; justify-content: space-between; gap: 10px; padding: 15px 25px; }
        
        input, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 14px; }
        textarea { height: 120px; font-family: 'Consolas', monospace; }
        
        .btn-group { display: flex; gap: 10px; }
        button { border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; font-size: 14px; }
        
        #saveBtn { background: var(--accent); color: white; flex-grow: 1; }
        #cancelEdit { background: #95a5a6; color: white; display: none; }
        .btn-export { background: var(--success); color: white; }
        .btn-import { background: #8e44ad; color: white; }

        .section { margin-bottom: 15px; border-radius: 8px; overflow: hidden; border: 1px solid #ddd; background: white; }
        .header-container { display: flex; background: var(--primary); align-items: center; color: white; }
        .header { flex-grow: 1; padding: 18px; cursor: pointer; font-weight: 600; }
        
        .action-btns { display: flex; height: 100%; }
        .action-btns button { border-radius: 0; padding: 0 12px; color: white; background: rgba(255,255,255,0.1); }
        .action-btns button:hover { background: rgba(255,255,255,0.2); }
        .del-btn:hover { background: var(--danger) !important; }

        .content { display: none; background: #272822; cursor: pointer; }
        pre { color: #f8f8f2; padding: 20px; margin: 0; overflow-x: auto; font-size: 18px; }
    </style>
</head>
<body>

    <h1>Code Review Manager</h1>

    <div class="backup-zone">
        <span style="font-weight: bold; color: var(--primary);">Data Management:</span>
        <div class="btn-group">
            <button class="btn-export" onclick="exportData()">↓ Export JSON</button>
            <button class="btn-import" onclick="document.getElementById('fileInput').click()">↑ Import JSON</button>
            <input type="file" id="fileInput" style="display:none" accept=".json" onchange="importData(event)">
        </div>
    </div>

    <div class="controls">
        <h3 id="formTitle">Add New Snippet</h3>
        <input type="hidden" id="editId">
        <input type="text" id="qInput" placeholder="Section Title">
        <textarea id="aInput" placeholder="Paste code here..."></textarea>
        <div class="btn-group">
            <button id="saveBtn" onclick="handleSave()">Save to Review List</button>
            <button id="cancelEdit" onclick="resetForm()">Cancel Edit</button>
        </div>
    </div>

    <div id="reviewContainer"></div>

    <script>
        let snippets = JSON.parse(localStorage.getItem('codeReviewItems') || '[]');

        document.addEventListener('DOMContentLoaded', renderAll);

        // --- EXPORT FUNCTION ---
        function exportData() {
            if (snippets.length === 0) return alert("Nothing to export!");
            const dataStr = JSON.stringify(snippets, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = 'code-review-backup.json';
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }

        // --- IMPORT FUNCTION ---
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedSnippets = JSON.parse(e.target.result);
                    if (Array.isArray(importedSnippets)) {
                        if (confirm("This will replace your current list. Continue?")) {
                            snippets = importedSnippets;
                            syncAndRender();
                        }
                    } else {
                        alert("Invalid file format.");
                    }
                } catch (err) {
                    alert("Error reading file.");
                }
            };
            reader.readAsText(file);
        }

        function handleSave() {
            const title = document.getElementById('qInput').value;
            const code = document.getElementById('aInput').value;
            const editId = document.getElementById('editId').value;

            if (!title || !code) return alert("Fill all fields");

            if (editId) {
                const index = snippets.findIndex(s => s.id == editId);
                snippets[index] = { ...snippets[index], title, code };
            } else {
                snippets.push({ id: Date.now(), title, code });
            }

            syncAndRender();
            resetForm();
        }

        function renderAll() {
            const container = document.getElementById('reviewContainer');
            container.innerHTML = snippets.length === 0 ? '<p style="text-align:center; color:#888;">No snippets yet.</p>' : '';
            
            snippets.forEach((snippet, index) => {
                const section = document.createElement('div');
                section.className = 'section';
                section.innerHTML = `
                    <div class="header-container">
                        <div class="header" onclick="toggleDisplay(this)">${escapeHTML(snippet.title)}</div>
                        <div class="action-btns">
                            <button onclick="move(${index}, -1)">▲</button>
                            <button onclick="move(${index}, 1)">▼</button>
                            <button onclick="editSnippet(${snippet.id})" style="color:#f1c40f">✎</button>
                            <button class="del-btn" onclick="deleteSnippet(${snippet.id})">&times;</button>
                        </div>
                    </div>
                    <div class="content" onclick="toggleDisplay(this.previousElementSibling.firstElementChild)">
                        <pre>${escapeHTML(snippet.code)}</pre>
                    </div>
                `;
                container.appendChild(section);
            });
        }

        function move(index, direction) {
            const newIndex = index + direction;
            if (newIndex < 0 || newIndex >= snippets.length) return;
            const temp = snippets[index];
            snippets[index] = snippets[newIndex];
            snippets[newIndex] = temp;
            syncAndRender();
        }

        function editSnippet(id) {
            const item = snippets.find(s => s.id === id);
            document.getElementById('qInput').value = item.title;
            document.getElementById('aInput').value = item.code;
            document.getElementById('editId').value = item.id;
            document.getElementById('formTitle').innerText = "Edit Snippet";
            document.getElementById('saveBtn').innerText = "Update Snippet";
            document.getElementById('cancelEdit').style.display = "block";
            window.scrollTo(0,0);
        }

        function deleteSnippet(id) {
            if (confirm("Delete permanently?")) {
                snippets = snippets.filter(s => s.id !== id);
                syncAndRender();
            }
        }

        function toggleDisplay(headerElement) {
            const content = headerElement.parentElement.nextElementSibling;
            content.style.display = (content.style.display === "block") ? "none" : "block";
        }

        function syncAndRender() {
            localStorage.setItem('codeReviewItems', JSON.stringify(snippets));
            renderAll();
        }

        function resetForm() {
            document.getElementById('qInput').value = '';
            document.getElementById('aInput').value = '';
            document.getElementById('editId').value = '';
            document.getElementById('formTitle').innerText = "Add New Snippet";
            document.getElementById('saveBtn').innerText = "Save to Review List";
            document.getElementById('cancelEdit').style.display = "none";
        }

        function escapeHTML(str) {
            return str.replace(/[&<>"']/g, m => ({'&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'}[m]));
        }
    </script>
</body>
</html>